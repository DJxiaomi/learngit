{js:kindeditor}
{js:artTemplate}
{js:areaSelect}
{js:my97date}
<script type="text/javascript" src="/plugins/newupload/plupload.full.min.js"></script>

<style>
.pic,.adpic { margin-bottom: 15px;}
.pic img { width: 100px; height: 56.25px;}
.adpic img{ width: 200px; height: 50px; }
#thumbnails2,#thumbnails3 { margin-top: 10px; }
#uploadButton2,#uploadButton3 { width: 228px; padding: 3px 10px;font-size: 12px; text-align: center; border: 1px solid #959595; background-color: #e9e9e9; margin-left: 10px; }
#uploadButton2:hover,#uploadButton3:hover { text-decoration: none;}
.form_table2 {width: 800px;margin-left: 120px;}
select.small {width: 120px;}
.demo {margin-top:8px;}
.form_table2 th {text-align: left;}
</style>

<script language="javascript">
var _tutor_cate_list = {if:$tutor_cate_list_json}{$tutor_cate_list_json}{else:}new Array(){/if};
</script>

<div class="headbar">
	<div class="position"><span>学校</span><span>></span><span>学校管理</span><span>></span><span>{if:isset($brand['id'])}编辑{else:}添加{/if}家教</span></div>
</div>
<div class="content_box">
	<div class="content form_content">
		<form action="{url:/brand/brand_save2}" method="post" enctype='multipart/form-data'>
			<table class="form_table" cellpadding="0" cellspacing="0">
				<col width="150px" />
				<col />
				<tr>
					<th>登录用户名：</th>
					<td><input class="normal" name="username" type="text" value="{$seller_info['seller_name']}" pattern="required" alt="登录用户名不能为空" />
						<label>*</label>

					</td>
				</tr>
				<tr>
					<th>登录密码：</th>
					<td><input class="normal" name="password" type="password" value="" />
						<label>*</label>
					</td>
				</tr>

				<tr>
					<th>教师姓名：</th>
					<td>
						<input class="normal" name="shortname" type="text" value="{$seller_info['shortname']}" pattern="required" alt="教师姓名不能为空" />
					</td>
				</tr>

				<tr>
					<th>性别：</th>
					<td>
						<input type="radio" name="sex" value="1" id="sex_1" {if:!$teacher_info || $teacher_info['sex'] != 2}checked{/if} />
						<label for="sex_1">男</label>&nbsp; &nbsp;
						<input type="radio" name="sex" value="2" id="sex_2" {if:$teacher_info['sex'] == 2}checked{/if} />
						<label for="sex_2">女</label>
					</td>
				</tr>

				<tr>
					<th>手机号：</th>
					<td>
						{if:$seller_info}
							{$seller_info['mobile']}
							<input class="normal" name="mobile" type="hidden" value="{$seller_info['mobile']}"/>
						{else:}
							<input class="normal" name="mobile" type="text" value="{$seller_info['mobile']}" pattern="required" alt="手机号不能为空" />
						{/if}
					</td>
				</tr>

				<tr>
					<th>身份证号码：</th>
					<td><input type="text" class="normal" name="cardsn" pattern="required" value="{$seller_info['cardsn']}" /></td>
				</tr>

				<tr>
					<th>形象照片：</th>
					<td>
						<input type='file' name='icon' />
						{if:isset($seller_info['logo']) && $seller_info['logo']}
						<p><a target="_blank" href="{webroot:}{$seller_info['logo']}"><img src='{webroot:}{$seller_info['logo']}' style='width:100px;border:1px solid #ccc' /></a></p>
						{/if}
					</td>
				</tr>

				<tr>
					<th>一句话介绍：</th>
					<td><input type="text" class="normal" name="brief" value="{$teacher_info['brief']}" /></td>
				</tr>

				<tr>
					<th>毕业院校：</th>
					<td><input type="text" class="normal" name="graduate" value="{$teacher_info['graduate']}" /></td>
				</tr>

				<tr>
					<th>学习专业：</th>
					<td><input type="text" class="normal" name="major" value="{$teacher_info['major']}" /></td>
				</tr>

				<tr>
					<th>教学特点：</th>
					<td><input type="text" class="normal" name="teaching_direction" value="{$teacher_info['teaching_direction']}" /></td>
				</tr>

				<tr>
					<th>教龄：</th>
					<td><input type="text" class="normal" name="experience" pattern="int" empty value="{$seller_info['experience']}" alt="教龄格式不正确" />年</td>
				</tr>

				<tr>
					<th>教师介绍：</th>
					<td><textarea name="description" id="description" style="float:left;width:600px;height:100px;">{$teacher_info['description']}</textarea></td>
				</tr>

				<tr>
					<th>教师资格证：</th>
					<td><input type='file' name='certificate' />
					{if:isset($teacher_info['certificate']) && $teacher_info['certificate']}
					<p><a target="_blank" href="{webroot:}{$teacher_info['certificate']}"><img src='{webroot:}{$teacher_info['certificate']}' style='width:100px;border:1px solid #ccc' /></a></p>
					{/if}
					</td>
				</tr>

				<tr>
					<th>身份证正面：</th>
					<td><input type='file' name='upphoto' />
					{if:isset($seller_info['upphoto']) && $seller_info['upphoto']}
					<p><a target="_blank" href="{webroot:}{$seller_info['upphoto']}"><img src='{webroot:}{$seller_info['upphoto']}' style='width:100px;border:1px solid #ccc' /></a></p>
					{/if}
					</td>
				</tr>

				<tr>
					<th>身份证背面：</th>
					<td><input type='file' name='downphoto' />
					{if:isset($seller_info['downphoto']) && $seller_info['downphoto']}
					<p><a target="_blank" href="{webroot:}{$seller_info['downphoto']}"><img src='{webroot:}{$seller_info['downphoto']}' style='width:100px;border:1px solid #ccc' /></a></p>
					{/if}
					</td>
				</tr>

				<tr>
					<td>
					<table class="form_table2" cellpadding="0">
						<tbody id="tbody">
							<tr>
								<th colspan="2"><label>年级</label>&nbsp; &nbsp; <a href="javascript:void(0);" class="add_grade">增加一行</a></th>
								<th><label>分类</label></th>
								<th><label>价格</th></label>
								<th><label>操作</label></th>
							</tr>
							{foreach:items=$seller_tutor_list item=$tutor_info}
							<tr>
								<td colspan="3">
									<select name="grade_level[]" class="grade_level">
										<option value="">请选择分类</option>
										{foreach:items=$tutor_cate_list}
											<option value="{$item['id']}" {if:$tutor_info['grade_level'] == $item['id']}selected{/if}>{$item['name']}</option>
										{/foreach}
									</select>
									<select name="grade[]" class="grade">
										{foreach:items=$tutor_cate_list}
											{if:$item['id'] == $tutor_info['grade_level']}
												{foreach:items=$item['child'] item=$it}
													<option value="{$it['id']}" {if:$tutor_info['grade'] == $it['id']}selected{/if}>{$it['name']}</option>
												{/foreach}
											{/if}
										{/foreach}
									</select>
								</td>
								<td>
									<input type="text" name="price[]" class="normal small" value="{$tutor_info['price']}" style="width: 80px;" placeholder="价格/时"/>
									<input type="hidden" name="tutor_id[]" value="{$tutor_info['id']}" />
								</td>
								<td><a href="javascript:void(0);" class="del_tutor">删除</a></td>
							</tr>
							{/foreach}
						</tbody>
					</table>
					</td>
				</tr>

				<tr>
					<th>授课时间：</th>
					<td>
						<a href="javascript:void(0);" class="add_teaching_time">添加一行</a><br />
						<table border="0" class="add_teaching_time_td">
							{foreach:items=$seller_info['teaching_time'] item=$it}
							<tr>
								<td>
									<select name="time1[]">
										{foreach:items=$teaching_time_arr key=$key}
											<option value="{$key}" {if:$it['time1'] == $key}selected{/if}>{$item}</option>
										{/foreach}
									</select>

									从<select name="time2[]">
										{foreach:items=$teaching_time_arr3 key=$key}
											<option value="{$key}" {if:$it['time2'] == $key}selected{/if}>{$item}</option>
										{/foreach}
									</select>点至
									<select name="time3[]">
										{foreach:items=$teaching_time_arr3 key=$key}
											<option value="{$key}" {if:$it['time3'] == $key}selected{/if}>{$item}</option>
										{/foreach}
									</select>点
									&nbsp; <a href="javascript:void(0);" class="del_teaching_time">删除</a>
								</td>
							</tr>
							{/foreach}
						</table>
					</td>
				</tr>

				<tr>
					<th>授课方式：</th>
					<td>{foreach:items=$teaching_type_arr key=$key}
					<input type="checkbox" name="teaching_type[]" value="{$key}" {if:!$seller_info['teaching_type'] || in_array($key, $seller_info['teaching_type'])}checked{/if} id="teaching_type_{$key}" /><label for="teaching_type_{$key}">{$item}</th>&nbsp; &nbsp;
					{/if}
					</td>
				</tr>

				<tr>
					<th>对学生的要求：</th>
					<td><input type="text" name="student_reqiures" value="{$teacher_info['student_reqiures']}" placeholder="" /></td>
				</tr>

				<tr>
					<th>账户类型：</th>
					<td>
						<select name="bank" onchange="getBank(this)">
							<option value="1"{if:$seller_info['bank'] == 1} selected{/if}>银行</option>
							<option value="2"{if:$seller_info['bank'] == 2} selected{/if}>支付宝</option>
						</select>
					</td>
				</tr>
				<tbody id="bank" style="{if:$seller_info['bank'] != 1}display:none;{/if}">
					<tr>
						<th>开户行：</th>
						<td><input type="text" class="normal" name="bankname" value="{$seller_info['bankname']}" /></td>
					</tr>
					<tr>
						<th>姓名：</th>
						<td><input type="text" class="normal" name="accountname" value="{$seller_info['accountname']}" /></td>
					</tr>
					<tr>
						<th>卡号：</th>
						<td><input type="text" class="normal" name="account" value="{$seller_info['account']}" /></td>
					</tr>
				</tbody>
				<tbody id="alipay" style="{if:$seller_info['bank'] != 2}display:none;{/if}">
					<tr>
						<th>姓名：</th>
						<td><input type="text" class="normal" name="alipayname" value="{$seller_info['alipayname']}" /></td>
					</tr>
					<tr>
						<th>支付宝帐号：</th>
						<td><input type="text" class="normal" name="alipaysn" value="{$seller_info['alipaysn']}" /></td>
					</tr>
				</tbody>

				<tr>
					<th>地区：</th>
					<td>
						<select name="province" id="province" child="city,area" onchange="changeProvince()"></select>
						<select name="city" id="city" child="area" onchange="changeCity()"></select>
						<select name="area" id="district"></select>
					</td>
				</tr>
				<tr>
					<th>详细地址：</th><td><input class="normal" name="address" type="text" value="{$brand['address']}" /></td>
				</tr>

				<!--update-->
					<tr>
						<th>推广码：</th><td><input class="normal" name="promo_code" type="text" value="{$brand['promo_code']}" /></td>
					</tr>
				<!--// update-->

				<tr>
					<th>是否接受预约：</th>
					<td><select name="is_receive_booking">
						<option value="1" selected>是</option>
						<option value="0" {if:$teacher_info['is_receive_booking'] == 0}selected{/if}>否</option>
					</select>
					<label>不接受预约，则用户无法购买家教</label>
				</td>
				</tr>

					<tr>
					<th></th>
					<td>
						<input type="hidden" name="accounttype" value="1" />
						<input type="hidden" name="brand_id" value="{$seller_info['brand_id']}" />
						<input type="hidden" name="teacher_id" value="{$teacher_info['id']}" />
						<button class="submit" type="submit"><span>确 定</span></button>
					</td>
				</tr>
			</table>
		</form>
	</div>
</div>

<table class="add_grade_html" style="display:none;">
	<tr>
		<td colspan="3">
			<select name="grade_level[]" class="grade_level">
				<option value="">请选择分类</option>
				{foreach:items=$tutor_cate_list}
					<option value="{$item['id']}">{$item['name']}</option>
				{/foreach}
			</select>
			<select name="grade[]" style="display:none;" class="grade"></select>
		</td>
		<td>
			<input type="text" name="price[]" class="normal small" value="" style="width: 80px;" placeholder="价格/时"/>
			<input type="hidden" name="tutor_id[]" value="0" />
		</td>
		<td><a href="javascript:void(0);" class="del_tutor">删除</a></td>
	</tr>
</table>

<table class="add_teaching_time_html" style="display:none;">
	<tr>
		<td>
			<select name="time1[]">
				{foreach:items=$teaching_time_arr key=$key}
					<option value="{$key}">{$item}</option>
				{/foreach}
			</select>

			从<select name="time2[]">
				{foreach:items=$teaching_time_arr3 key=$key}
					<option value="{$key}">{$item}</option>
				{/foreach}
			</select>点至
			<select name="time3[]">
				{foreach:items=$teaching_time_arr3 key=$key}
					<option value="{$key}">{$item}</option>
				{/foreach}
			</select>点
			&nbsp; <a href="javascript:void(0);" class="del_teaching_time">删除</a>
		</td>
	</tr>
</table>

<script language="javascript">
//var formObj = new Form('sellerForm');
//formObj.init({echo:JSON::encode($seller_info)});

$(function(){

	setProvince('{$seller_info['province']}', '{$seller_info['city']}' , '{$seller_info['area']}');

	{if:$seller_info['is_auth'] == 1}
	$('input,select,textarea').attr('disabled', true);
	{/if}

	$('.add_grade').click(function(){
		$('#tbody').append("<tr><td>" + $('.add_grade_html').html()+"</td></tr>");
	})

	$(document).on('click', '.del_tutor',function(){
		$(this).parent().parent().remove();
	});

	$('.alt_btn').click(function(){
		var _cardsn = $('input[name=cardsn]').val();
		var _bankname = $('input[name=bankname]').val();
		var _accountname = $('input[name=accountname]').val();
		var _account = $('input[name=account]').val();

		if ( _cardsn == '')
		{
			alert('身份证号不能为空');
			$('input[name=cardsn]').focus();
		} else if ( _bankname == '')
		{
			alert('开户银行不能为空');
			$('input[name=bankname]').focus();
		} else if ( _accountname == '')
		{
			alert('银行户名不能为空');
			$('input[name=accountname]').focus();
		} else if ( _account == '')
		{
			alert('银行账号不能为空');
			$('input[name=account]').focus();
		} else {
			$('#sellerForm').submit();
		}
	})

	$(document).on('change', '.grade_level',function(){
		set_category($(this),$(this).val());
	});
	$(document).on('change','.grade',function(){
		var _grade_level = $(this).parent().parent().find(".grade_level").val();
		set_category($(this), _grade_level, $(this).val());
	});

	$('.add_teaching_time').click(function(){
		var _html = $('.add_teaching_time_html').html();
		$('.add_teaching_time_td').append(_html);
	})

	$(document).on('click', '.del_teaching_time', function(){
		$(this).parent().parent().remove();
	})
});

function set_category(obj, grade_level, grade, cate_id)
{
	var _grade_html = '';
	var _cate_id_html = '';
	if ( obj && grade_level )
	{
			for( var i in _tutor_cate_list )
			{
				if ( _tutor_cate_list[i]['id'] == grade_level && _tutor_cate_list[i]['child'] )
				{
						for( var j in _tutor_cate_list[i]['child'] )
						{
							var _selected = (grade && _tutor_cate_list[i]['child'][j]['id'] == grade ) ? 'selected' : '';
							_grade_html += "<option value='" + _tutor_cate_list[i]['child'][j]['id'] + "' " + _selected + ">"  + _tutor_cate_list[i]['child'][j]['name'] + "</option>";

							if ( _tutor_cate_list[i]['child'][j]['id'] == grade && _tutor_cate_list[i]['child'][j]['child'])
							{
								for ( var k in _tutor_cate_list[i]['child'][j]['child'] )
								{
									var _selected = (cate_id && _tutor_cate_list[i]['child'][j]['child'][k]['id'] == cate_id ) ? 'selected' : '';
									_cate_id_html += "<option value='" + _tutor_cate_list[i]['child'][j]['child'][k]['id'] + "' " + _selected + ">"  + _tutor_cate_list[i]['child'][j]['child'][k]['name'] + "</option>";
								}

								obj.parent().find('.cate_id').html(_cate_id_html);
								obj.parent().find('.cate_id').show();
							}
						}

						obj.parent().find(".grade").html(_grade_html);
						obj.parent().find(".grade").show();
				}
			}
	}
}

function changeProvince(){
    setCity($("#province").val());
}

function changeCity(){
    setCity($("#province").val(), $("#city").val());
}
function setProvince(provinceVal, cityVal, districtVal){
    var province = $("#province");
    var city = $("#city");
    province.get(0).options.length = 0;
    city.get(0).options.length = 0;
    $.getJSON("{url:/block/area_child_my}/aid/0", function(json){
        if(json!=null){
            $.each(json, function(i, n){
                var option = new Option(n, i);
                if (i == provinceVal) {
                    option.selected = true;
                }
                province.get(0).options.add(option);
            });
            if(province.val())
                province.show();
            else
                province.hide();
            setCity(province.val(), cityVal, districtVal);
        }else{
            province.hide();
            city.hide();
        }
    });
}
function setCity(provinceVal, cityVal, districtVal){
    var city = $("#city");
    city.get(0).options.length = 0;
    provinceVal = provinceVal == null ? '' : provinceVal;
    $.getJSON("{url:/block/area_child_my}/aid/" + provinceVal, function(json){
        if(json!=null){
            $.each(json, function(i, n){
                var option = new Option(n, i);
                if (i == cityVal) {
                    option.selected = true;
                }
                city.get(0).options.add(option);
            });
            if(city.val())
                city.show();
            else
                city.hide();
            setDistrict(city.val(), districtVal);
        }else{
            city.hide();
        }
    });
}

function setDistrict(cityVal, districtVal){
    var district = $("#district");
    district.get(0).options.length = 0;
    cityVal = cityVal == null ? '' : cityVal;
    $.getJSON("{url:/block/area_child_my}/aid/" + cityVal, function(json){
        if(json!=null){
            $.each(json, function(i, n){
                var option = new Option(n, i);
                if (i == districtVal) {
                    option.selected = true;
                }
                district.get(0).options.add(option);
            });
            if(district.val())
                district.show();
            else
                district.hide();
        }else{
            district.hide();
        }
    });
}

function getBank(obj){
	if($(obj).val() == 1){
		$('#bank').show();
		$('#alipay').hide();
	}else if($(obj).val() == 2){
		$('#bank').hide();
		$('#alipay').show();
	}else{
		return;
	}
}

</script>
