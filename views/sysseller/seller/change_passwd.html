{js:artTemplate}
{js:kindeditor}
{js:my97date}
<script src="/views/default/javascript/layer/layer.js"></script>
<style>
.hide { display: none; }
#allmap { width: 700px; height: 400px; }
input.normal {height: 25px;line-height: 25px;text-indent:3px;}
table{width:100%;}
th {text-align:right;width:40%;}
tr{height:40px;}
span.red {margin-left:3px;}
.send_sms {margin-left:15px;}
.form_table input.send_sms {
	padding: 0 10px;
	height: 28px;
	line-height: 28px;
	display: inline-block;
	background-color: #f2f2f2;
	color: #000;
	border-radius: 3px;
	text-decoration: none;
	border: 1px solid #c5c5c5;
	cursor: pointer;
}
.form_table input.disable {
	color: #ccc;
}
.form_table .send_sms_notice {
	margin-top: 10px;
	background: url(/views/mobile/skin/blue/images/right.png) 0 3px no-repeat;
	background-size: 13px 13px;
	padding-left: 18px;
	display: none;
}
</style>

<article class="module width_full">
	<header>
		<h3>修改密码</h3>
	</header>

	<form method="post" name="change_passwd" id="change_passwd" onsubmit="return check_form();">
		<div class="module_content">

      <table class="form_table">
        <tr>
          <th>手机号：</th>
          <td>{echo: substr($seller_info['mobile'], 0, 3)}****{echo: substr($seller_info['mobile'], -3)}<input type="button" class="send_sms" value="获取验证码" onclick="sendMessage();"/></td>
        </tr>
        <tr>
          <th>手机验证码：</th>
          <td>
            <input name="mobile_code" class="gray_s normal" type="text" pattern="required" alt="请输入短信息中验证码" />
            <div class="send_sms_notice">验证码已发送到您的手机，请查收</div>
          </td>
        </tr>
        <tr>
          <td colspan="2" align="center">
            <input type="submit" value="修改" class="alt_btn" name="submit"/>&nbsp; &nbsp;
            <input type="reset" value="重置" />&nbsp; &nbsp;
          </td>
        </tr>
      </table>

	</form>
</article>

<script language="javascript">
var default_time = 60;
var s_count = 60;
var send_status = true;

//发送短信码
function sendMessage()
{
	if ( s_count == default_time && send_status )
	{
    $.getJSON("{url:/seller/get_change_passwd_code}",{},function(response){
      console.log( response );
      if ( response.done !== false )
      {
        update_sms_status();
        time = setInterval(function(){
          update_sms_status();
        }, 1000);
        $('.send_sms').addClass('disable');
        $('.send_sms_notice').show();
      } else {
        alert(response.msg);
        return;
      }
    });
	}
}

function update_sms_status()
{
	if ( s_count > 0 )
	{
		s_count--;
		send_status = false;
		$('#mobileWay .send_sms').attr('disabled',"true");
		$('#mobileWay .send_sms').val('重新发送验证码(' + s_count + ' s)');
		$('#mobileWay .send_sms').css('cursor', 'wait');
	} else {
		s_count = default_time;
		send_status = true;
		clearInterval(time);

		$('#mobileWay .send_sms').val('重新发送验证码');
		$('#mobileWay .send_sms').removeAttr("disabled");
		$('#mobileWay .send_sms').removeClass('disable');
		$('#mobileWay .send_sms').css('cursor', 'pointer');
	}
}
</script>
