{js:artTemplate}
{js:areaSelect}
<article class="module width_full">
	<header>
		<h3>认证信息</h3>
	</header>

	<form action="{url:/seller/seller_add6}" method="post" name="sellerForm" enctype='multipart/form-data'>
		<div class="module_content">
					<fieldset>
					<label>商户真实全称：</label>
						<td><input class="normal" name="true_name" type="text" value="" pattern="required" /></td>
					</fieldset>
					<fieldset>
						<label>营业执照号码：</label>
						<td><input class="normal" name="papersn" type="text" value="" /></td>
					</fieldset> 
					<fieldset>
						<label>营业执照：</label>
						<td>
							<input type='file' name='paper_img' />
							{if:isset($this->sellerRow['paper_img']) && $this->sellerRow['paper_img']}
							<p><a target="_blank" href="{webroot:}{$this->sellerRow['paper_img']}"><img src='{webroot:}{$this->sellerRow['paper_img']}' style='width:320px;border:1px solid #ccc' /></a></p>
							{/if}
						</td>
					</fieldset>

					<fieldset>
						<label>法人代表姓名：</label>
						<td><input type="text" class="normal" name="legal" value="{$this->sellerRow['legal']}" /></td>
					</fieldset>
					<fieldset>
						<label>法人身份证号码：</label>
						<td><input type="text" class="normal" name="cardsn" value="{$this->sellerRow['cardsn']}" /></td>
					</fieldset>
					<fieldset>
						<label>法人身份证正面：</label>
						<td>
							<input type='file' name='upphoto' />
							{if:isset($this->sellerRow['upphoto']) && $this->sellerRow['upphoto']}
							<p><a target="_blank" href="{webroot:}{$this->sellerRow['upphoto']}"><img src='{webroot:}{$this->sellerRow['upphoto']}' style='width:320px;border:1px solid #ccc' /></a></p>
							{/if}
						</td>
					</fieldset>
					<fieldset>
						<label>法人身份证背面：</label>
						<td>
							<input type='file' name='downphoto' />
							{if:isset($this->sellerRow['downphoto']) && $this->sellerRow['downphoto']}
							<p><a target="_blank" href="{webroot:}{$this->sellerRow['downphoto']}"><img src='{webroot:}{$this->sellerRow['downphoto']}' style='width:320px;border:1px solid #ccc' /></a></p>
							{/if}
						</td>
					</fieldset>

					<fieldset>
						<label>安全手机号码：</label>
                              <td><input type="text" class="normal" name="safe_mobile" value="{$this->sellerRow['safe_mobile']} "/>修改认证信息、结算账户、接收信息手机</td>
			        </fieldset>		
					<fieldset>
						<label>联系人：</label>
						<td><input type="text" class="normal" name="contacter" value="{$this->sellerRow['contacter']}" /></td>
					</fieldset>
					<fieldset>
						<label>联系人身份证号码：</label>
						<td><input type="text" class="normal" name="contactcardsn" value="{$this->sellerRow['contactcardsn']}" /></td>
					</fieldset>
					<fieldset>
						<label>联系人身份证正面：</label>
						<td>
							<input type='file' name='cupphoto' />
							{if:isset($this->sellerRow['cupphoto']) && $this->sellerRow['cupphoto']}
							<p><a target="_blank" href="{webroot:}{$this->sellerRow['cupphoto']}"><img src='{webroot:}{$this->sellerRow['cupphoto']}' style='width:320px;border:1px solid #ccc' /></a></p>
							{/if}
						</td>
					</fieldset>
					<fieldset>
						<label>联系人身份证背面：</label>
						<td>
							<input type='file' name='cdownphoto' />
							{if:isset($this->sellerRow['cdownphoto']) && $this->sellerRow['cdownphoto']}
							<p><a target="_blank" href="{webroot:}{$this->sellerRow['cdownphoto']}"><img src='{webroot:}{$this->sellerRow['cdownphoto']}' style='width:320px;border:1px solid #ccc' /></a></p>
							{/if}
						</td>
					</fieldset>

					<fieldset>
						<td></td><td><button class="submit" type="submit"><span>提交认证</span></button></td>
					</fieldset>
	        </div>
		</form>

</article>
<script language="javascript">
//DOM加载完毕
$(function()
{
//修改模式
{if:$this->sellerRow}
var formObj = new Form('sellerForm');
formObj.init({echo:JSON::encode($this->sellerRow)});

//锁定字段一旦注册无法修改
if($('[name="id"]').val())
{
	var lockCols = ['seller_name'];
	for(var index in lockCols)
	{
		$('input:text[name="'+lockCols[index]+'"]').addClass('readonly');
		$('input:text[name="'+lockCols[index]+'"]').attr('readonly',true);
	}
}
{/if}

//地区联动插件
var areaInstance = new areaSelect('province');
areaInstance.init({echo:JSON::encode($this->sellerRow)});
});

function getAu(obj){
	if($(obj).val() == 2){
		$('#authorization').show();
	}else{
		$('#authorization').hide();
	}
}

function getBank(obj){
	if($(obj).val() == 1){
		$('#bank').show();
		$('#alipay').hide();
	}else if($(obj).val() == 2){
		$('#bank').hide();
		$('#alipay').show();
	}else{
		return;
	}
}

var default_time = 60;
var s_count = 60;
var send_status = true;

//发送短信码
function sendMessage()
{
	var username = $('#mobileWay [name="username"]').val();
	var mobile   = $('#mobileWay [name="mobile"]').val();
	var myreg = /^(((13[0-9]{1})|(15[0-9]{1})|(17[0-9]{1})|(18[0-9]{1}))+\d{8})$/;

	if ( username == '' )
	{
		$('#mobileWay').submit();
		return false;
	}
	if(!myreg.test(mobile))
	{
		$('#mobileWay').submit();
		return false;
	}

	if ( s_count == default_time && send_status )
	{
		$.get("{url:/simple/send_reg_sms}",{"mobile":mobile,"type":2},function(content){
			if(content == 'success')
			{
				update_sms_status();
				time = setInterval(function(){
					update_sms_status();
				}, 1000);
				$('#mobileWay .send_sms').addClass('disable');
				$('.form_table .send_sms_notice').show();
			}
			else
			{
				alert(content);
				return;
			}
		});
	}
}

function update_sms_status()
{
	if ( s_count > 0 )
	{
		s_count--;
		send_status = false;
		$('#mobileWay .send_sms').attr('disabled',"true");
		$('#mobileWay .send_sms').val('重新发送验证码(' + s_count + ' s)');
		$('#mobileWay .send_sms').css('cursor', 'wait');
	} else {
		s_count = default_time;
		send_status = true;
		clearInterval(time);

		$('#mobileWay .send_sms').val('重新发送验证码');
		$('#mobileWay .send_sms').removeAttr("disabled");
		$('#mobileWay .send_sms').removeClass('disable');
		$('#mobileWay .send_sms').css('cursor', 'pointer');
	}
}
</script>
