{set:$seller_id = $this->seller['seller_id']}

{set:$searchParam = http_build_query(Util::getUrlParam('search'))}

{set:$condition = Util::search(IReq::get('search'));

	$where = $condition ? " and ".$condition : "";

}

{query:name=delivery }

	{set:$delivery_id=$item['id']}

	{set:$kuaidi["$delivery_id"] = $item['name']}

{/query}
<style>
	.tab_current{background:#24b408 !important;color:#fff !important;}
</style>
<article class="module width_full">

	<header>

		<h3 class="tabs_involved">平台推荐</h3>

		<ul class="tabs">

			<!-- <li><input type="button" class="alt_btn" onclick="filterResult();" value="搜索订单" /></li> -->
			<li><input type="button" class="alt_btn" onclick="javascript:location.href='/seller/order_list'" value="全款订单" /></li>
			<li><input type="button" class="alt_btn tab_current" onclick="javascript:location.href='/seller/order_prop_list'" value="推荐订单" /></li>
			<li><input type="button" class="alt_btn" onclick="javascript:location.href='/seller/order_list2'" value="定金订单" /></li>
			<li><input type="button" class="alt_btn" onclick="javascript:location.href='/seller/order_seat_list'" value="购票订单" /></li>
			<li><input type="button" class="alt_btn" onclick="javascript:location.href='/seller/sale_tixian'" value="帐务中心" /></li>

		</ul>

	</header>



	<table class="tablesorter" cellspacing="0">

		<thead>

			<tr>

				<th>学员姓名</th>

				<th>联系电话</th>

				<th>推荐编号</th>

				<th>关注课程</th>

				<th>课程属性</th>

				<th>数量</th>

				<th>订单状态</th>

				<th>推荐时间</th>

				<th>提示</th>

				<th>操作</th>

			</tr>

		</thead>



		<tbody>

			{set:$page = IReq::get('page') ? IFilter::act(IReq::get('page'),'int') : 1}

			{query:name=order as o fields=o.* page=$page where=o.seller_id eq $seller_id and o.pay_status eq 1 and o.if_del eq 0 and o.statement eq 2 and o.status not in(3,4) $where  id=$orderObject order=o.id desc}

			{set:$order_status_t = Order_Class::getOrderStatus($item);}

			{set:$goods_list = Order_Class::get_order_goods_list($item['id'])}

			{set:$goods = $goods_list[0]}

			{set:$goods_array = $goods['goods_array']}

			<tr>

				<td title="{$item['accept_name']}">{$item['accept_name']}</td>

				<td title="{$item['mobile']}">{$item['mobile']}</td>

				<td title="{$item['order_no']}" name="orderStatusColor{$item['status']}">{$item['order_no']}</td>

				{if:$item['chit_id'] > 0}

					{set:$chit_info = brand_chit_class::get_chit_info($item['chit_id'])}

					{if:!$chit_info}

						<td colspan="2">代金券可能已被删除</a></td>

					{else:}

						<td colspan="2"><a href="{url:/site/chit_show/id/$chit_info['id']}" target="_blank">{echo:brand_chit_class::get_chit_name($chit_info['max_price'], $chit_info['max_order_chit'])}</a></td>

					{/if}

				{else:}

					<td><a href="{url:/site/products/id/$goods['goods_id']}" target="_blank">{$goods_array->name}</a></td>

					<td>{$goods_array->value}</td>

				{/if}

				<td>{$goods['goods_nums']}</td>

				<td>

					<b class="{if:$order_status_t >= 6}green{else:}orange{/if}">

					{if:$item['chit_id'] > 0 }

						{echo:order_class::orderStatusText2(order_class::getOrderStatus($item))}

					{else:}

						{echo:order_class::orderStatusText(order_class::getOrderStatus($item),2, $item['statement'])}

					{/if}

					</b>

				</td>

				<td title="{$item['create_time']}">{echo: date('Y-m-d H:i', strtotime($item['create_time']))}</td>

				<td>{echo:order_class::get_order_notice(order_class::getOrderStatus($item),2)}</td>

				<td>

						{if:in_array( order_class::getOrderStatus( $item ), array(4))}

							<a href="{url:/seller/order_finish/order_id/$item['id']}">确认收款</a>

						{/if}

						<a href="{url:/seller/order_show_dai/id/$item[id]}">详情</a>

				</td>

			</tr>

			{/query}

		</tbody>

	</table>

	{$orderObject->getPageBar()}

</article>



<script type="text/html" id="orderTemplate">

	<form action="{url:/}" method="get" name="filterForm">

		<input type='hidden' name='controller' value='seller' />

		<input type='hidden' name='action' value='order_prop_list' />

		<div class="module_content">

			<fieldset>

				<label>订单号</label>

				<input name="search[order_no=]" value="" type="text" />

			</fieldset>



			<fieldset>

				<label>学员姓名</label>

				<input name="search[accept_name=]" value="" type="text" />

			</fieldset>

		</div>

	</form>

</script>



<script language="javascript">

	//检索课程

	function filterResult(){

		var ordersHeadHtml = template.render('orderTemplate');

		art.dialog(	{		"init":function()

		{

			var filterPost = {echo:JSON::encode(IReq::get('search'))};

			var formObj = new Form('filterForm');

			for(var index in filterPost)

			{

				formObj.setValue("search["+index+"]",filterPost[index]);

			}

		},

		"title":"检索条件",

		"content":ordersHeadHtml,

		"okVal":"立即检索",

		"ok":function(iframeWin, topWin)

		{

			iframeWin.document.forms[0].submit();

		}

	});

}



//DOM加载结束

$(function(){

	//高亮色彩

	$('[name="payStatusColor1"]').addClass('green');

	$('[name="disStatusColor1"]').addClass('green');

	$('[name="orderStatusColor3"]').addClass('red');

	$('[name="orderStatusColor4"]').addClass('red');

	$('[name="orderStatusColor5"]').addClass('green');

});

</script>

